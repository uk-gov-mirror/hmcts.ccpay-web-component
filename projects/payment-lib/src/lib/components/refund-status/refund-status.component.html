
<div *ngIf="errorMessage">
  <div class="error-summary" role="group" aria-labelledby="failure-error-summary-heading" tabindex="-1">
    <h2 class="heading-medium error-summary-heading" id="failure-error-summary-heading">
      Error in processing the request
    </h2>
    <div class="govuk-error-summary__body">
      {{ errorMessage }}
    </div>
  </div>
</div>
<ng-container *ngIf="viewName==='refundstatuslist' && rejectedRefundList">
  <!-- payments -->

  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <td class="govuk-table__header col-16" scope="col">Status</td>
        <td class="govuk-table__header col-11" scope="col">Amount</td>
        <td class="govuk-table__header col-18" scope="col">Date</td>
        <td class="govuk-table__header col-25" scope="col">Refund reference</td>
        <td class="govuk-table__header col-24 " scope="col">Reason</td>
        <td class="govuk-table__header" scope="col"></td>
      </tr>
    </thead>
    <tbody class="govuk-table__body" *ngIf="rejectedRefundList?.length > 0">
      <tr class="govuk-table__row" *ngFor="let refundList of rejectedRefundList">
        <td class="govuk-table__cell whitespace-inherit">{{ refundList?.refund_status['name'] }}</td>
        <td class="channel govuk-table__cell whitespace-inherit">£{{ refundList?.amount | number:'.2' }}</td>
        <td class="govuk-table__cell  whitespace-inherit">{{ refundList?.date_updated | date:'dd MMM yyyy'}}
        </td>
        <td class="govuk-table__cell whitespace-inherit">{{ refundList?.refund_reference }}</td>
        <td class="govuk-table__cell whitespace-inherit"> {{refundList?.reason}}</td>
        <td class="govuk-table__cell whitespace-inherit">
          <a href="javascript:void(0)" (click)="goToRefundView(refundList,'casetransactions')">Review</a>
        </td>
      </tr>
    </tbody>
    <tbody class="govuk-table__body" *ngIf="rejectedRefundList?.length === 0">
      <td class="govuk-table__cell" colspan="6">No refunds recorded</td>
    </tbody>
  </table>
</ng-container>

<ng-container *ngIf="viewName==='refundview'">
  <div class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a  href="javascript:void(0)" (click)="loadRefundListPage()" class="govuk-back-link govuk-label">Back</a>
      </li>
    </ol>
  </div>
  <h2 class="govuk-heading-l">Refund details</h2>
  <table>
    
    <tbody>
      <tr class="section">
        <td class="bold tb-col-w">Refund reference</td>
        <td>{{ refundlist?.refund_reference }}</td>
      </tr>
      <tr class="section">
        <td class="bold tb-col-w">Payment to be refunded</td>
        <td>{{refundlist?.payment_reference }}</td>
      </tr>
      <tr class="section">
        <td class="bold tb-col-w">Reason for refund</td>
        <td>{{ refundlist?.reason }}</td>
      </tr>
      <tr class="section">
        <td class="bold tb-col-w">Amount refunded</td>
        <td>£{{refundlist?.amount | number:'.2' }}</td>
      </tr>

    </tbody>
  </table>

  <!-- Status history -->
  <div>
    <br />
    <h2 class="govuk-heading-m">Refund status history</h2>
    <div *ngIf="refundStatusHistories">
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <td class="govuk-table__header col-24 whitespace-inherit" scope="col">Status</td>
          <td class="govuk-table__header col-27 whitespace-inherit" scope="col">Date and time</td>
          <td class="govuk-table__header whitespace-inherit" scope="col">Users</td>
          <td class="govuk-table__header whitespace-inherit" scope="col">Notes</td>
        </tr>
      </thead>
      <tbody class="govuk-table__body" *ngFor="let refundStatusHistory of refundStatusHistories;">
        <tr class="govuk-table__row">
          <td class="govuk-table__cell whitespace-inherit">{{refundStatusHistory.status}}</td>
          <td class="govuk-table__cell whitespace-inherit">{{refundStatusHistory.date_created | date:'d MMMM yyyy
            hh:mm:ss'}}</td>
          <td class="govuk-table__cell whitespace-inherit">{{refundStatusHistory.created_by}}</td>
          <td class="govuk-table__cell whitespace-inherit">{{refundStatusHistory.notes}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  </div>

  <ng-container *ngIf="viewName==='refundview'">
    <div *ngIf="refundButtonState==='Update required'">
      <!-- <div *ngIf="refundButtonState==='sent back'"> -->
      <br />
      <button type="submit" class="button govuk-button--secondary btnmargin"
        (click)="gotoReviewAndReSubmitPage()">Resubmit
        refund</button>
    </div>
    <div *ngIf="isProcessRefund && !isLastUpdatedByCurrentUser && refundButtonState==='Sent for approval'" >
      <!-- <div *ngIf="isProcessRefund && !isLastUpdatedByCurrentUser && refundButtonState==='sent for approval'"> -->
      <br />
      <button type="submit" class="button govuk-button--secondary"
        (click)="goToRefundProcessComponent(refundlist.refund_reference,refundlist)">Process refund</button>
    </div>
  </ng-container>


</ng-container>

<ng-container *ngIf="viewName==='reviewandsubmitview'">
  <!-- <div class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a (click)="gotoReviewDetailsPage($event)" class="govuk-back-link govuk-label">Back</a>
      </li>
    </ol>
  </div> -->
  <div class="govuk-warning-text">
    <h1 class="heading-large">Review and resubmit refund</h1>
  </div>
  <table class="govuk-table">
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-!-font-weight-bold">Reason for rejection</td>
      <td class="govuk-table__cell">{{refundreason}}</td>
    </tr>
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-!-font-weight-bold">Refund reference</td>
      <td class="govuk-table__cell">{{ refundlist?.refund_reference}} </td>
    </tr>
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-!-font-weight-bold">Reason for refund</td>
      <td class="govuk-table__cell"> {{ refundlist?.reason}}
        <a (click)="gotoRefundReasonPage()" *ngIf="refundlist?.reason !== 'Retrospective remission'"
          class="govuk-link right">Change</a>
      </td>

      <!-- <td class="govuk-table__cell">{{ refundlist?.reason }}</td>
      <a (click)="gotoRefundReasonPage()" class="govuk-link right">Change</a> -->
    </tr>
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-!-font-weight-bold">Payment reference</td>
      <td class="govuk-table__cell">{{ refundlist?.payment_reference}} </td>
    </tr>
    <tr class="govuk-table__row">
      <td *ngIf="refundlist?.reason === 'Retrospective remission'" class="govuk-table__cell govuk-!-font-weight-bold">Refund amount</td>
      <td *ngIf="refundlist?.reason !== 'Retrospective remission'" class="govuk-table__cell govuk-!-font-weight-bold">Payment amount</td>
      <td class="govuk-table__cell"> £{{ changedAmount | number:'.2' }}
        <a (click)="gotoAmountPage()" *ngIf="refundlist?.reason === 'Retrospective remission'"
          class="govuk-link right">Change</a>
      </td>

    </tr>
  </table>
  <div class="govuk-button-group">
    <button (click)="gotoReviewDetailsPage($event)" class="govuk-button govuk-button--secondary"> Previous</button>
    <button [disabled]="isRefundBtnDisabled" (click)="gotoReviewRefundConfirmationPage()" class="govuk-button button"
      data-module="govuk-button">
      Submit refund
    </button>
</div>
<p><a href="javascript:void(0)" (click)="loadRefundListPage()" class="govuk-link" data-module="govuk-button">Cancel</a></p>
  <!-- <div class="govuk-button-group">
    <button [disabled]="isRefundBtnDisabled" (click)="gotoReviewRefundConfirmationPage()" class="govuk-button button"
      data-module="govuk-button">
      Submit refund
    </button>
  </div> -->
  <!-- <p>
    <a (click)="loadRefundListPage()" href="" class="cancelbtn">Cancel</a>
  </p> -->
</ng-container>

<ng-container *ngIf="viewName === 'issuerefund'">
  <ccpay-add-remission [isFromRefundListPage]="true" [viewCompStatus]="viewName" [isRefundRemission]="true"
    [ccdCaseNumber]="ccdCaseNumber" (refundListReason)="getRefundListReason($event)"></ccpay-add-remission>
</ng-container>

<ng-container *ngIf="viewName === 'processretroremissonpage'">
  <ccpay-add-remission [isFromRefundListPage]="true" [viewCompStatus]="viewName" [isRefundRemission]="true"
    [ccdCaseNumber]="ccdCaseNumber" (refundListAmount)="getRefundAmount($event)"></ccpay-add-remission>
</ng-container>

<ng-container *ngIf="viewName === 'reviewrefundconfirmationpage'">
  <div class="govuk-grid-row pagesize">
    <div>
      <div class="govuk-panel govuk-panel--confirmation">
        <h1 class="govuk-panel__title">
          Refund submitted
        </h1>

        <div class="govuk-panel__body">
          <p class="govuk-body white"><strong>Refund reference:{{refundReference}} </strong></p>
        </div>

      </div>

      <h2 class="govuk-heading-l">What happens next</h2>
      <p class="govuk-body">
        A refund request for {{refundAmount| currency:'GBP':'symbol-narrow':'1.2-2'}} has been created and will be passed to a team leader to approve.
      </p>

      <p class="govuk-body">
        <a href="javascript:void(0)" (click)="loadRefundListPage()" class="govuk-link">Return to case</a>
      </p>
    </div>
  </div>
</ng-container>
